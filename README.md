# VetCare Pro - 動物病院向け電子カルテシステム (v3.1)

**VetCare Pro** は、小規模〜中規模の動物病院向けに設計された、軽量かつ多機能な電子カルテシステムです。
患畜管理、診療記録（SOAP）、会計（レセプト対応）、在庫管理、予約管理、LINE連携機能を一元化し、獣医療の現場をサポートします。

> ⚠️ **開発・監修に関するご注意**
> 本システムはAIにより生成されたコード生成がありますが、AI特有の実装不可能な機能の提案やAIでは作れないシステム（どうしてもアメリカ仕様になるなど）が含まれていたため、人の手による修正・調整が少なからず加えられています。原形をとどめていないところもあるので、「AIでこんなツールが生成できる！」という紹介などに使うのはやめたほうが良いかもしれません。
> * **民間の動物病院での勤務経験がない公務員獣医師**が監修を行っています。そのため、一般的な小動物臨床（民間病院）のワークフローや商習慣とは一部異なる仕様が含まれている可能性があります。導入の際は運用フローをご確認ください。

---

## 🚀 主な機能

### 🏥 診療・カルテ管理
* **ダッシュボード**: 予約、入院、未処理オーダー、売上状況の一覧表示
* **電子カルテ (SOAP)**: 写真・画像添付対応。過去歴の参照、テンプレート機能
* **入院管理**: バイタルサイン・投薬記録（温度板機能）、退院サマリー作成
* **オーダー管理**: 処方、検査、処置のオーダー発行とステータス管理
* **病理・検査**: 院内検査機器からのCSVデータ取込、外部検査結果の管理

### 💰 会計・事務
* **会計・請求**: 領収書、明細書の発行。未収金管理
* **ペット保険対応**: レセプト作成、保険会社マスタ管理（アニコム、アイペット等のフォーマット対応）あまり理解しないまま作ってます。
* **各種書類作成**: 紹介状、診断書、ワクチン証明書、同意書などの作成・印刷

### 📅 予約・顧客対応
* **予約管理**: カレンダー形式での予約枠管理
* **Web予約（公開用）**: 飼い主がスマホから予約できる公開ページ
* **LINE連携**: 予約完了通知、リマインダー、ワクチン接種時期の自動通知
* **待合ディスプレイ**: 待合室向けの順番表示（番号呼び出し/名前呼び出し対応）

### ⚙️ 管理・システム
* **在庫管理**: 薬品・消耗品の在庫管理と発注点アラート
* **ユーザー管理**: 獣医師、看護師、受付などの権限管理（RBAC）
* **セキュリティ**: 操作ログの監査（改ざん検知）、IPアドレス制限

---

## 🛠️ 動作環境

本システムは標準的な **PHP** 環境で動作します。

* **PHP**: 8.0 以上 (必須)
* **データベース**: SQLite (デフォルト/推奨) または MySQL/MariaDB
* **Webサーバー**: Apache, Nginx など
* **必須拡張モジュール**: `pdo`, `pdo_sqlite` (または `pdo_mysql`), `json`, `mbstring`, `session`

---

## 🔒 セキュリティとデプロイに関する重要事項

### 公開予約ページ（Web予約）の配置について
本パッケージには `booking/` ディレクトリに公開用の予約システムが含まれています。
デフォルトでは `https://your-domain.com/booking/` のようにサブディレクトリでの運用が可能になっていますが、**セキュリティの観点からは、電子カルテ本体（個人情報・カルテデータ）とは完全に切り離された別のドメイン（またはサブドメイン）で運用することを強く推奨します。**

* **現在の構成（便宜上）**: 同一サーバー内の別ディレクトリに配置
* **推奨される構成**: 予約フロントエンドを別サーバー/別ドメインに配置し、API経由で連携する

### データディレクトリの保護
`data/` ディレクトリ（SQLiteデータベース格納場所）や `backups/` ディレクトリには、Webブラウザから直接アクセスできないように `.htaccess` 等でアクセス制限をかけてください（Apache用設定ファイルは同梱されていますが、Nginx等の場合は別途設定が必要です）。

---

## 📦 インストール手順

### 1. ファイルの配置
Webサーバーの公開ディレクトリにすべてのファイルをアップロードします。

### 2. 権限の設定
以下のディレクトリにWebサーバーからの **書き込み権限** を付与してください。
* `data/` (データベース保存用)
* `uploads/` (画像・ファイル保存用)
* `backups/` (バックアップ保存用)
* `plugins/` (プラグイン用)

### 3. インストーラーの実行
ブラウザでトップページ（例: `http://localhost/vetcare/`）にアクセスすると、自動的にセットアップウィザードが起動します。画面の指示に従ってください。

1.  **環境チェック**: 必須PHP拡張やディレクトリ権限を確認
2.  **データベース初期化**: テーブルの作成
3.  **管理者アカウント作成**: 最初のログインユーザーを作成
4.  **施設設定**: 病院名や診療時間の設定

---

## 🗄️ データベース設定（MySQLを使用する場合）

デフォルトでは手軽な **SQLite** が設定されています。大規模な運用で **MySQL** を使用する場合は、インストール前に設定ファイルを編集してください。

`includes/config.php`:
```php
// データベース設定
define('DB_DRIVER', 'mysql'); // 'sqlite' から変更

define('DB_MYSQL_HOST', 'localhost');
define('DB_MYSQL_NAME', 'vetcare_db');
define('DB_MYSQL_USER', 'your_user');
define('DB_MYSQL_PASS', 'your_password');
